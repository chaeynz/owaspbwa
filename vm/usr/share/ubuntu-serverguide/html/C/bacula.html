<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head xmlns="http://www.w3.org/1999/xhtml">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title xmlns="">Bacula</title>
    <link rel="stylesheet" href="../../libs/ubuntu-book.css" type="text/css" />
    <link rel="home" href="index.html" title="Ubuntu Server Guide" />
    <link rel="up" href="backups.html" title="Chapter 18. Backups" />
    <link rel="prev" href="backups-shellscripts-rotation.html" title="Archive Rotation" />
    <link rel="next" href="virtualization.html" title="Chapter 19. Virtualization" />
    <link rel="copyright" href="legal.html" title="Credits and License" />
  </head>
  <body>
    <div id="round">
      <img id="topcap" alt="" src="https://help.ubuntu.com/htdocs/ubuntunew/img/cap-top.png" />
      <div id="layout" class="container clear-block">
        <script xmlns="" src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script>
        <script xmlns="" type="text/javascript">
_uacct = "UA-1018242-8";
urchinTracker();
</script>
        <div id="header">
          <div id="logo-floater">
            <h1>
              <a href="https://help.ubuntu.com" title="Ubuntu Documentation">
                <img alt="Ubuntu" id="logo" src="https://help.ubuntu.com/htdocs/ubuntunew/img/logo.png" />
              </a>
            </h1>
          </div>
          <noscript>
            <form action="http://www.google.com/cse" id="cse-search-box">
              <div>
                <input type="hidden" name="cx" value="004599128559784038176:vj_p0xo-nng" />
                <input type="hidden" name="ie" value="UTF-8" />
                <input type="text" name="q" size="27" />
                <input type="submit" name="sa" value="Search" />
              </div>
            </form>
          </noscript>
          <script>
 document.write('<form action="https://help.ubuntu.com/search.html" id="cse-search-box">');
 document.write('  <div>');
 document.write('    <input type="hidden" name="cof" value="FORID:9" />');
 document.write('    <input type="hidden" name="cx" value="004599128559784038176:vj_p0xo-nng" />');
 document.write('    <input type="hidden" name="ie" value="UTF-8" />');
 document.write('    <input type="text" name="q" size="27" />');
 document.write('    <input type="submit" name="sa" value="Search" />');
 document.write('  </div>');
 document.write('</form>');
</script>
          <div id="sitename">
            <a href="https://help.ubuntu.com/">
              <img alt="Official Documentation" src="https://help.ubuntu.com/htdocs/ubuntunew/img/help-about.png" />
              <span>Official Documentation</span>
            </a>
          </div>
        </div>
        <div id="page">
          <div id="content">
            <div class="breadcrumbs"><a href="https://help.ubuntu.com/">Ubuntu Documentation</a> &gt; <a href="https://help.ubuntu.com/10.04">Ubuntu 10.04</a> &gt; <span class="breadcrumb-link"><a href="index.html">Ubuntu Server Guide</a></span> &gt; <span class="breadcrumb-link"><a href="backups.html">Backups</a></span> &gt; <span class="breadcrumb-node">Bacula</span></div>
            <div xmlns="http://www.w3.org/1999/xhtml" class="sect1" title="Bacula">
              <div class="titlepage">
                <div>
                  <div>
                    <h2 class="title" style="clear: both"><a id="bacula"></a>Bacula</h2>
                  </div>
                </div>
              </div>
              <p>
    <span class="application"><strong>Bacula</strong></span> is a backup program enabling you to backup, restore, and verify data across your network. There are Bacula 
    clients for Linux, Windows, and Mac OSX. Making it a cross platform network wide solution.
    </p>
              <div class="sect2" title="Overview">
                <div class="titlepage">
                  <div>
                    <div>
                      <h3 class="title"><a id="bacula-overview"></a>Overview</h3>
                    </div>
                  </div>
                </div>
                <p>
      <span class="application"><strong>Bacula</strong></span> is made up of several components and services used to manage which files to backup and where to back 
      them up to:
      </p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" type="disc">
                    <li class="listitem">
                      <p>
          <span class="application"><strong>Bacula Director:</strong></span> a service that controls all backup, restore, verify, and archive operations.
          </p>
                    </li>
                    <li class="listitem">
                      <p>
          <span class="application"><strong>Bacula Console:</strong></span> an application allowing communication with the Director. There are three versions of the 
          Console:
          </p>
                      <div class="itemizedlist">
                        <ul class="itemizedlist" type="circle">
                          <li class="listitem">
                            <p>Text based command line version.</p>
                          </li>
                          <li class="listitem">
                            <p>Gnome based GTK+ Graphical User Interface (GUI) interface.</p>
                          </li>
                          <li class="listitem">
                            <p>wxWidgets GUI interface.</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="listitem">
                      <p>
          <span class="application"><strong>Bacula File:</strong></span> also known as the <span class="application"><strong>Bacula Client</strong></span> program. 
          This application is installed on machines to be backed up, and is responsible for the data requested by the Director. 
          </p>
                    </li>
                    <li class="listitem">
                      <p>
	  <span class="application"><strong>Bacula Storage:</strong></span> the programs that perform the storage and recovery of data to the physical media.
          </p>
                    </li>
                    <li class="listitem">
                      <p>
	  <span class="application"><strong>Bacula Catalog:</strong></span> is responsible for maintaining the file indexes and volume databases for all files backed up,  
          enabling quick location and restoration of archived files. The Catalog supports three different databases MySQL, PostgreSQL, and SQLite.
          </p>
                    </li>
                    <li class="listitem">
                      <p>
	  <span class="application"><strong>Bacula Monitor:</strong></span> allows the monitoring of the Director, File daemons, and Storage daemons. 
          Currently the Monitor is only available as a GTK+ GUI application.
          </p>
                    </li>
                  </ul>
                </div>
                <p>
      These services and applications can be run on multiple servers and clients, or they can be installed on one machine if backing up a 
      single disk or volume.
      </p>
              </div>
              <div class="sect2" title="Installation">
                <div class="titlepage">
                  <div>
                    <div>
                      <h3 class="title"><a id="bacula-installation"></a>Installation</h3>
                    </div>
                  </div>
                </div>
                <p>
      There are multiple packages containing the different <span class="application"><strong>Bacula</strong></span> components. To install Bacula,
      from a terminal prompt enter:
      </p>
                <pre class="screen">
<span class="command"><strong>sudo apt-get install bacula</strong></span>
</pre>
                <p>
      By default installing the <span class="application"><strong>bacula</strong></span> package will use a 
      <span class="application"><strong>MySQL</strong></span> database for the Catalog. If you want to use SQLite or 
      PostgreSQL, for the Catalog, install <span class="application"><strong>bacula-director-sqlite3</strong></span> 
      or <span class="application"><strong>bacula-director-pgsql</strong></span> respectively.
      </p>
                <p>
      During the install process you will be asked to supply credentials for the 
      database <span class="emphasis"><em>administrator</em></span> and the <span class="emphasis"><em>bacula</em></span> 
      database <span class="emphasis"><em>owner</em></span>. The database administrator will need to have 
      the appropriate rights to create a database, see <a class="xref" href="mysql.html" title="MySQL">the section called “MySQL”</a> for more 
      information.
      </p>
              </div>
              <div class="sect2" title="Configuration">
                <div class="titlepage">
                  <div>
                    <div>
                      <h3 class="title"><a id="bacula-configuration"></a>Configuration</h3>
                    </div>
                  </div>
                </div>
                <p>
      <span class="application"><strong>Bacula</strong></span> configuration files are formatted based on <span class="emphasis"><em>resources</em></span> comprising of 
      <span class="emphasis"><em>directives</em></span> surrounded by <span class="quote">“<span class="quote">{}</span>”</span> braces.  Each Bacula component has an individual file in the
      <code class="filename">/etc/bacula</code> directory.
      </p>
                <p>
      The various <span class="application"><strong>Bacula</strong></span> components must authorize themselves to each other. This is accomplished using the 
      <span class="emphasis"><em>password</em></span> directive. For example, the <span class="emphasis"><em>Storage</em></span> resource password in the 
      <code class="filename">/etc/bacula/bacula-dir.conf</code> file must match the <span class="emphasis"><em>Director</em></span> resource password in 
      <code class="filename">/etc/bacula/bacula-sd.conf</code>.
      </p>
                <p>
      By default the backup job named <span class="emphasis"><em>Client1</em></span> is configured to archive the <span class="application"><strong>Bacula</strong></span> Catalog. 
      If you plan on using the server to backup more than one client you should change the name of this job to something more descriptive. 
      To change the name edit <code class="filename">/etc/bacula/bacula-dir.conf</code>:
      </p>
                <pre class="programlisting">
#
# Define the main nightly save backup job
#   By default, this job will back up to disk in 
Job {
  Name = "BackupServer"
  JobDefs = "DefaultJob"
  Write Bootstrap = "/var/lib/bacula/Client1.bsr"
}
</pre>
                <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <table border="0" summary="Note">
                    <tr>
                      <td rowspan="2" align="center" valign="top" width="25">
                        <img alt="[Note]" src="../../libs/admon/note.png" />
                      </td>
                      <th align="left"></th>
                    </tr>
                    <tr>
                      <td align="left" valign="top">
                        <p>
	The example above changes the job name to <span class="emphasis"><em>BackupServer</em></span> matching the machine's host name.  Replace 
        <span class="quote">“<span class="quote">BackupServer</span>”</span> with your appropriate hostname, or other descriptive name.
	</p>
                      </td>
                    </tr>
                  </table>
                </div>
                <p>
      The <span class="emphasis"><em>Console</em></span> can be used to query the <span class="emphasis"><em>Director</em></span> about jobs, but to use the Console with a 
      <span class="emphasis"><em>non-root</em></span> user, the user needs to be in the <span class="emphasis"><em>bacula</em></span> group. To add a user to the bacula group 
      enter the following from a terminal:
      </p>
                <pre class="screen">
<span class="command"><strong>sudo adduser $username bacula</strong></span>
</pre>
                <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
                  <table border="0" summary="Note">
                    <tr>
                      <td rowspan="2" align="center" valign="top" width="25">
                        <img alt="[Note]" src="../../libs/admon/note.png" />
                      </td>
                      <th align="left"></th>
                    </tr>
                    <tr>
                      <td align="left" valign="top">
                        <p>
        Replace <span class="emphasis"><em>$username</em></span> with the actual username.  Also, if you are adding the current user to the group you should 
        log out and back in for the new permissions to take effect.
        </p>
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
              <div class="sect2" title="Localhost Backup">
                <div class="titlepage">
                  <div>
                    <div>
                      <h3 class="title"><a id="bacula-localhost-backup"></a>Localhost Backup</h3>
                    </div>
                  </div>
                </div>
                <p>
      This section describes how to backup specified directories on a single host to a local tape drive.
      </p>
                <div class="itemizedlist">
                  <ul class="itemizedlist" type="disc">
                    <li class="listitem">
                      <p>
          First, the <span class="emphasis"><em>Storage</em></span> device needs to be configured. Edit <code class="filename">/etc/bacula/bacula-sd.conf</code> add:
          </p>
                      <pre class="programlisting">
Device {
  Name = "Tape Drive"
  Device Type = tape
  Media Type = DDS-4
  Archive Device = /dev/st0
  Hardware end of medium = No;
  AutomaticMount = yes;               # when device opened, read it
  AlwaysOpen = Yes;
  RemovableMedia = yes;
  RandomAccess = no;
  Alert Command = "sh -c 'tapeinfo -f %c | grep TapeAlert'"
}
</pre>
                      <p>
          The example is for a <span class="emphasis"><em>DDS-4</em></span> tape drive.  Adjust the Media Type and Archive Device to match your hardware.
          </p>
                      <p>
          You could also uncomment one of the other examples in the file.
          </p>
                    </li>
                    <li class="listitem">
                      <p>
          After editing <code class="filename">/etc/bacula/bacula-sd.conf</code> the <span class="application"><strong>Storage</strong></span> daemon will need to be 
          restarted:
          </p>
                      <pre class="screen">
<span class="command"><strong>sudo /etc/init.d/bacula-sd restart</strong></span>
</pre>
                    </li>
                    <li class="listitem">
                      <p>
          Now add a <span class="emphasis"><em>Storage</em></span> resource in <code class="filename">/etc/bacula/bacula-dir.conf</code> to use the new Device:
          </p>
                      <pre class="programlisting">
# Definition of "Tape Drive" storage device
Storage {
  Name = TapeDrive
  # Do not use "localhost" here    
  Address = backupserver               # N.B. Use a fully qualified name here
  SDPort = 9103
  Password = "Cv70F6pf1t6pBopT4vQOnigDrR0v3LT3Cgkiyj"
  Device = "Tape Drive"
  Media Type = tape
}
</pre>
                      <p>
          The <span class="emphasis"><em>Address</em></span> directive needs to be the Fully Qualified Domain Name (FQDN) of the server. 
          Change <span class="emphasis"><em>backupserver</em></span> to the actual host name.
          </p>
                      <p>
          Also, make sure the <span class="emphasis"><em>Password</em></span> directive matches the password string in 
          <code class="filename">/etc/bacula/bacula-sd.conf</code>. 
          </p>
                    </li>
                    <li class="listitem">
                      <p>
          Create a new <span class="emphasis"><em>FileSet</em></span>, which will determine what directories to backup, by adding:
          </p>
                      <pre class="programlisting">
# LocalhostBacup FileSet.
FileSet {
  Name = "LocalhostFiles"
  Include {
    Options {
      signature = MD5
      compression=GZIP
    }
    File = /etc
    File = /home
  }
}
</pre>
                      <p>
          This <span class="emphasis"><em>FileSet</em></span> will backup the <code class="filename">/etc</code> and 
          <code class="filename">/home</code> directories.  The <span class="emphasis"><em>Options</em></span> resource directives 
          configure the FileSet to create a MD5 signature for each file backed up, and to compress the files using GZIP.
          </p>
                    </li>
                    <li class="listitem">
                      <p>
          Next, create a new <span class="emphasis"><em>Schedule</em></span> for the backup job:
          </p>
                      <pre class="programlisting">
# LocalhostBackup Schedule -- Daily.
Schedule {
  Name = "LocalhostDaily"
  Run = Full daily at 00:01
}
</pre>
                      <p>
          The job will run every day at 00:01 or 12:01 am. There are many other scheduling options available.
          </p>
                    </li>
                    <li class="listitem">
                      <p>
          Finally create the <span class="emphasis"><em>Job</em></span>:
          </p>
                      <pre class="programlisting">
# Localhost backup.
Job {
  Name = "LocalhostBackup"
  JobDefs = "DefaultJob"
  Enabled = yes
  Level = Full
  FileSet = "LocalhostFiles"
  Schedule = "LocalhostDaily"
  Storage = TapeDrive
  Write Bootstrap = "/var/lib/bacula/LocalhostBackup.bsr"
}  
</pre>
                      <p>
          The job will do a <span class="emphasis"><em>Full</em></span> backup every day to the tape drive.
          </p>
                    </li>
                    <li class="listitem">
                      <p>
          Each tape used will need to have a <span class="emphasis"><em>Label</em></span>. If the current tape does not have a label 
          <span class="application"><strong>Bacula</strong></span> will send an email letting you know. To label a tape using the 
          <span class="application"><strong>Console</strong></span> enter the following from a terminal:
          </p>
                      <pre class="screen">
<span class="command"><strong>bconsole</strong></span>
</pre>
                    </li>
                    <li class="listitem">
                      <p>
          At the Bacula Console prompt enter:
          </p>
                      <pre class="screen">
<span class="command"><strong>label</strong></span>
</pre>
                    </li>
                    <li class="listitem">
                      <p>
          You will then be prompted for the <span class="emphasis"><em>Storage</em></span> resource:
          </p>
                      <pre class="screen">
<code class="computeroutput">
Automatically selected Catalog: MyCatalog
Using Catalog "MyCatalog"
The defined Storage resources are:
     1: File
     2: TapeDrive
Select Storage resource (1-2):<strong class="userinput"><code>2</code></strong>
</code>
</pre>
                    </li>
                    <li class="listitem">
                      <p>
          Enter the new <span class="emphasis"><em>Volume</em></span> name:
          </p>
                      <pre class="screen">
<code class="computeroutput">
Enter new Volume name: <strong class="userinput"><code>Sunday</code></strong>
Defined Pools:
     1: Default
     2: Scratch</code>
</pre>
                      <p>
          Replace <span class="emphasis"><em>Sunday</em></span> with the desired label.
          </p>
                    </li>
                    <li class="listitem">
                      <p>
	  Now, select the <span class="emphasis"><em>Pool</em></span>:
          </p>
                      <pre class="screen">
<code class="computeroutput">
Select the Pool (1-2): <strong class="userinput"><code>1</code></strong>
Connecting to Storage daemon TapeDrive at backupserver:9103 ...
Sending label command for Volume "Sunday" Slot 0 ...
</code>
</pre>
                    </li>
                  </ul>
                </div>
                <p>
      Congratulations, you have now configured <span class="emphasis"><em>Bacula</em></span> to backup the localhost to an attached tape drive.
      </p>
              </div>
              <div class="sect2" title="Resources">
                <div class="titlepage">
                  <div>
                    <div>
                      <h3 class="title"><a id="bacula-resources"></a>Resources</h3>
                    </div>
                  </div>
                </div>
                <div class="itemizedlist">
                  <ul class="itemizedlist" type="disc">
                    <li class="listitem">
                      <p>
	  For more <span class="emphasis"><em>Bacula</em></span> configuration options refer to the 
          <a class="ulink" href="http://www.bacula.org/en/rel-manual/index.html" target="_top">Bacula User's Manual</a>
          </p>
                    </li>
                    <li class="listitem">
                      <p>
          The <a class="ulink" href="http://www.bacula.org/" target="_top">Bacula Home Page</a> contains the latest Bacula news and developments.
          </p>
                    </li>
                    <li class="listitem">
                      <p>
          Also, see the <a class="ulink" href="https://help.ubuntu.com/community/Bacula" target="_top">Bacula Ubuntu Wiki</a> page.
          </p>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div xmlns="http://www.w3.org/1999/xhtml" class="navfooter">
            <hr />
            <table width="100%" summary="Navigation footer">
              <tr>
                <td width="40%" align="left"><a accesskey="p" href="backups-shellscripts-rotation.html"><img src="../../libs/navig/prev.png" alt="Prev" /></a> </td>
                <td width="20%" align="center">
                  <a accesskey="u" href="backups.html">
                    <img src="../../libs/navig/up.png" alt="Up" />
                  </a>
                </td>
                <td width="40%" align="right"> <a accesskey="n" href="virtualization.html"><img src="../../libs/navig/next.png" alt="Next" /></a></td>
              </tr>
              <tr>
                <td width="40%" align="left" valign="top">Archive Rotation </td>
                <td width="20%" align="center">
                  <a accesskey="h" href="index.html">
                    <img src="../../libs/navig/home.png" alt="Home" />
                  </a>
                </td>
                <td width="40%" align="right" valign="top"> Chapter 19. Virtualization</td>
              </tr>
            </table>
          </div>
          <hr />
          <div id="footer">
            <div id="ubuntulinks">
              <p>The material in this document is available under a free license, see <a href="/legal.html">Legal</a> for details<br />
	For information on contributing see the <a href="https://wiki.ubuntu.com/DocumentationTeam">Ubuntu Documentation Team wiki page</a>. To report a problem, visit the <a href="https://bugs.launchpad.net/ubuntu/+source/ubuntu-docs">bug page for Ubuntu Documentation</a></p>
            </div>
          </div>
          <div id="bottomcap">
            <img src="https://help.ubuntu.com/htdocs/ubuntunew/img/cap-bottom.png" alt="" />
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
